#!/bin/bash
# *****************************************************************************
#  configure                                                     TaoJS project
# *****************************************************************************
#
#   File Description:
#
#      Configure 'make-it-quick' with the most-common options
#      Those will be used by the Makefile to generate config.system-setup.mk
#      This script is mostly to inferface "like autoconf"
#
#
#
#
#
# *****************************************************************************
#  (C) 2017 Christophe de Dinechin <christophe@dinechin.org>
#  This software is licensed under the GNU General Public License v3
#******************************************************************************
#     This file is part of make-it-quick
#
#     make-it-quick is free software: you can redistribute it and/or modify
#     it under the terms of the GNU General Public License as published by
#     the Free Software Foundation, either version 3 of the License, or
#     (at your option) any later version.
#
#     make-it-quick is distributed in the hope that it will be useful,
#     but WITHOUT ANY WARRANTY; without even the implied warranty of
#     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#     GNU General Public License for more details.
#
#     You should have received a copy of the GNU General Public License
#     along with make-it-quick.  If not, see <https://www.gnu.org/licenses/>.
# *****************************************************************************

SETUP=configured.mk

output() {
    echo $1 >> $SETUP
}

rm -f $SETUP

# DD='$(DESTDIR)'
while [ $# -ne 0 ]; do
    case "$1" in
    --build=*)                          output IGNORED_BUILD=${1/--build=/}/;;
    --host=*)                           output IGNORED_HOST=${1/--host=/}/;;
    --program-prefix=*)                 output IGNORED_PROGRAM_PREFIX=${1/--program-prefix=/}/;;
    --disable-dependency-tracking)      output IGNORED_DEPENDENCY_TRACKING=0;;
    --prefix=*)                         output PREFIX=$DD${1/--prefix=/}/;;
    --exec-prefix=*)                    output PREFIX.exec=$DD${1/--exec-prefix=/}/;;
    --bindir=*)                         output PREFIX.bin=$DD${1/--bindir=/}/;;
    --sbindir=*)                        output PREFIX.sbin=$DD${1/--sbindir=/}/;;
    --sysconfigdir=*)                   output SYSCONFIG=$DD${1/--sysconfigdir=/}/;;
    --datadir=*)                        output PREFIX.share=$DD${1/--datadir=/}/;;
    --includedir=*)                     output PREFIX.h=$DD${1/--includedir=/}/;;
    --libdir=*)                         output PREFIX.lib=$DD${1/--libdir=/}/;;
    --libexecdir=*)                     output PREFIX.libexec=$DD${1/--libexecdir=/}/;;
    --localstatedir=*)                  output PREFIX.var=$DD${1/--localstatedir=/}/;;
    --sharedstatedir==*)                output PREFIX.str=$DD${1/--sharedstatedir=/}/;;
    --mandir==*)                        output PREFIX.man=$DD${1/--mandir=/}/;;
    --infodir==*)                       output PREFIX.info=$DD${1/--infodir=/}/;;
    esac
    shift
done

# Emit the location of configuration sources
output 'CONFIG_SOURCES=$(PREFIX.lib)make-it-quick/config/'

echo "# Summary of configuration:"
cat $SETUP
